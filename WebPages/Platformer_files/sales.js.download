"use strict";(function(){"use strict";const r=window.SteamDB;function W(e){const n=document.createElement("h3");n.textContent="An error has occurred.";const s=document.createElement("p");s.textContent=e.message;const t=document.getElementById("js-filter-loader");t.replaceChildren(n,s),t.style.height="unset",document.getElementById("js-app").classList.remove("app-loading")}function V(){document.getElementById("js-app").classList.remove("app-loading"),document.getElementById("js-filter-loader").hidden=!0,document.querySelector(".filters-details").classList.remove("js-filters-details-loading")}function P(){document.querySelector(".filters-details").classList.add("js-filters-details-loading"),window.addEventListener("pageshow",e=>{e.persisted&&V()},{once:!0})}if(window.addEventListener("error",W),!("SteamDB"in window)||!("$"in window)||!("DataTable"in $.fn)){W(new Error("Some dependencies failed to load, try reloading the page."));return}TimeAgo.cssTooltip=!1,TimeAgo.datetime=function(e){return new Date(Number.parseInt(e.dataset.sort,10)*1e3)},document.querySelectorAll(".filter-select").forEach(e=>{const n=e.querySelector(".filter-select-search input");e.addEventListener("toggle",()=>{e.open&&n&&window.matchMedia("(hover: hover)").matches&&n.focus()}),e.querySelectorAll("label .filter-exclude-checkbox").forEach(s=>{const t=s.closest("label").querySelector("input");s.classList.contains("filter-exclude-checkbox-on")&&(t.indeterminate=!0),t.addEventListener("change",a=>{!t.indeterminate&&a.isTrusted&&s.classList.remove("filter-exclude-checkbox-on")}),s.addEventListener("click",a=>{a.preventDefault(),a.stopImmediatePropagation();const o=!s.classList.contains("filter-exclude-checkbox-on");t.checked=o,t.indeterminate=o,s.classList.toggle("filter-exclude-checkbox-on",o),t.dispatchEvent(new Event("change",{bubbles:!0}))})}),n&&(n.addEventListener("keydown",s=>{(s.key==="Escape"||s.key==="Tab"&&s.shiftKey)&&(e.open=!1)}),n.addEventListener("input",function(){const s=this.value.trim().toUpperCase();e.querySelectorAll(".filter-scrollable label").forEach(t=>{t.hidden=!t.textContent.toUpperCase().includes(s)})}))}),document.addEventListener("click",function(e){const n=document.querySelector(".filter-select[open]");e.target instanceof Element&&n&&!n.contains(e.target)&&(n.open=!1)});let d=null,F,K;const le=e=>{const n=document.body.dataset.storeAssets;let s=0;const t=function(o){o.querySelectorAll(".timeago").forEach(u=>{TimeAgo.init(u)});const p=o.dataset.capsule;if(!p)return;let i;o.classList.contains("package")?i=`${n}subs/${o.dataset.subid}/${p}`:i=`${n}apps/${o.dataset.appid}/${p}`;const c=o.querySelector(".applogo img");c.src=i},a=function(){s=0;const o=200,f=window.innerHeight+o,p=[];e=e.filter(i=>{if(!i.parentNode)return!0;const c=i.getBoundingClientRect();return c.top<f&&c.bottom>-o?(p.push(i),!1):!0});for(const i of p)t(i)};K=()=>{clearTimeout(s),a()},F=()=>{s||!e.length||(s=setTimeout(a,100))},window.addEventListener("scroll",F,{passive:!0}),window.addEventListener("resize",F,{passive:!0})};document.querySelectorAll(".applogo img").forEach(r.ImageError),le(Array.from(document.querySelectorAll(".table-sales .app, .table-sales .package")));const de=document.querySelector("#js-sales-count"),m=document.querySelector("#js-filters"),G=m.dataset.pageType,A=G==="sales",l=A?"sales":"special",Q=document.querySelector("#js-select-type input:checked")?.value,H=document.querySelector(".current-sale-filters-contain"),N=document.querySelector(".current-sale-filters"),Z=H.querySelector("#js-remove-svg > svg");Z.parentElement.remove(),N.querySelectorAll(".sale-filter > button").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault(),P();const s=e.dataset.id,t=new URLSearchParams(location.search);if(A&&(s==="min_discount"||s==="min_rating"||s==="min_reviews"))t.set(s,"0");else if(e.dataset.value){const a=(t.get(s)||"").split(","),o=a.indexOf(e.dataset.value);o>-1&&a.splice(o,1),a.length===0?t.delete(s):t.set(s,a.join(","))}else t.delete(s);t.sort(),location.search=t.toString()})});function g(e,n,s){if(!s){N.querySelector(`span[data-id="${e}"]`)?.remove(),N.childElementCount===0&&(H.hidden=!0);return}const t=document.createElement("span");t.className="sale-filter",t.dataset.id=e,t.textContent=n;const a=document.createElement("button");a.type="button",a.append(Z.cloneNode(!0)),t.append(a),N.append(t),a.addEventListener("click",o=>{o.preventDefault(),document.getElementById(e).click()}),H.hidden=!1}let v=!1;const y=document.querySelector("#js-wishlisted-only");function J(){g(y.id,"Wishlisted",v)}y?.addEventListener("change",function(e){e.stopImmediatePropagation(),v=this.checked,J(),v?r.Storage.Set(l+"-wishlisted-only","1"):r.Storage.Remove(l+"-wishlisted-only"),h=!0,d.draw()});let b=!1;const E=document.querySelector("#js-owned-only");function X(){g(E.id,"Owned",b)}E?.addEventListener("change",function(e){e.stopImmediatePropagation(),b=this.checked,X(),b?r.Storage.Set(l+"-owned-only","1"):r.Storage.Remove(l+"-owned-only"),h=!0,d.draw()});let k=!1;const U=document.querySelector("#js-followed-only");function ee(){g(U.id,"Followed",k)}U.addEventListener("change",function(e){e.stopImmediatePropagation(),k=this.checked,ee(),k?r.Storage.Set(l+"-followed-only","1"):r.Storage.Remove(l+"-followed-only"),h=!0,d.draw()});let L=!1;function te(){g(M.id,"Historical lows",L)}const M=document.querySelector("#js-discounts-blue");M.addEventListener("change",function(e){e.stopImmediatePropagation(),L=this.checked,te(),L?r.Storage.Set(l+"-blue-discounts-only","1"):r.Storage.Remove(l+"-blue-discounts-only"),h=!0,d.draw()});let q=!1;function ne(){g(_.id,"Matching lows",q)}const _=document.querySelector("#js-discounts-green");_.addEventListener("change",function(e){e.stopImmediatePropagation(),q=this.checked,ne(),q?r.Storage.Set(l+"-green-discounts-only","1"):r.Storage.Remove(l+"-green-discounts-only"),h=!0,d.draw()});let D=!1;function se(){g(z.id,"2-year lows",D)}const z=document.querySelector("#js-discounts-minor");z.addEventListener("change",function(e){e.stopImmediatePropagation(),D=this.checked,se(),D?r.Storage.Set(l+"-minor-discounts-only","1"):r.Storage.Remove(l+"-minor-discounts-only"),h=!0,d.draw()});let T=!1;const w=document.querySelector("#js-hide-owned-games");function oe(){g(w.id,"Hide owned",T)}w?.addEventListener("change",function(e){e.stopImmediatePropagation(),T=this.checked,oe(),T?r.Storage.Set(l+"-hide-owned-games","1"):r.Storage.Remove(l+"-hide-owned-games"),h=!0,d.draw()});let C=!1;const x=document.querySelector("#js-hide-ignored-games");function ae(){g(x.id,"Hide ignored",C)}x.addEventListener("change",function(e){e.stopImmediatePropagation(),C=this.checked,ae(),C?r.Storage.Set(l+"-hide-ignored-games","1"):r.Storage.Remove(l+"-hide-ignored-games"),h=!0,d.draw()});let j=!1;const I=document.querySelector("#js-hide-wishlisted");function re(){g(I.id,"Hide wished and followed",j)}I.addEventListener("change",function(e){e.stopImmediatePropagation(),j=this.checked,re(),j?r.Storage.Set(l+"-hide-wished","1"):r.Storage.Remove(l+"-hide-wished"),h=!0,d.draw()});const ue=()=>{if(y&&(y.removeAttribute("disabled"),y.parentElement.classList.remove("tooltipped")),E&&E.removeAttribute("disabled"),U.removeAttribute("disabled"),U.parentElement.classList.remove("tooltipped"),w&&(w.removeAttribute("disabled"),w.parentElement.classList.remove("tooltipped")),x.removeAttribute("disabled"),x.parentElement.classList.remove("tooltipped"),I.removeAttribute("disabled"),I.parentElement.classList.remove("tooltipped"),y&&r.Storage.Get(l+"-wishlisted-only")&&(y.checked=!0,v=!0,J()),E&&r.Storage.Get(l+"-owned-only")&&(E.checked=!0,b=!0,X()),r.Storage.Get(l+"-followed-only")&&(U.checked=!0,k=!0,ee()),r.Storage.Get(l+"-hide-ignored-games")&&(x.checked=!0,C=!0,ae()),r.Storage.Get(l+"-hide-wished")&&(I.checked=!0,j=!0,re()),Array.from(d.rows(".package").nodes()).forEach(function(e){let n=!A;const s=e.dataset.apps.split(",");delete e.dataset.apps;for(const t of s){const a=Number(t);if(r.FollowedApps.has(a)&&e.classList.add("followed"),r.WishedApps.has(a)&&(e.classList.add("wished"),!n)){n=!0;const o=d.cell(e,0),f=o.node();f.dataset.sort=(Number(f.dataset.sort)+9).toString(),o.invalidate()}r.IgnoredApps.has(a)&&e.classList.add("ignored")}return!0}),A){const e=Q==="Wishlist";Array.from(d.rows(".app").nodes()).forEach(function(n){const s=Number(n.dataset.appid);let t=0;if(e||r.WishedApps.has(s)?(n.querySelector(".price-discount-major")?t=30:n.querySelector(".price-discount, .price-discount-minor")?t=20:t=10,e&&r.FamilySharedApps.has(s)&&(t-=200)):r.OwnedApps.has(s)?t=-5:r.FamilySharedApps.has(s)&&(t=-4),t!==0){const a=d.cell(n,0),o=a.node();o.dataset.sort=(Number(o.dataset.sort)+t).toString(),a.invalidate()}return!0})}d.draw()};w&&r.Storage.Get(l+"-hide-owned-games")&&(w.checked=!0,T=!0,oe()),r.Storage.Get(l+"-blue-discounts-only")&&(M.checked=!0,L=!0,te()),r.Storage.Get(l+"-green-discounts-only")&&(_.checked=!0,q=!0,ne()),r.Storage.Get(l+"-minor-discounts-only")&&(z.checked=!0,D=!0,se()),$.fn.dataTable.ext.search.push(function(e,n,s){const t=e.aoData[s].nTr;if(L||q||D){const a=!!t.querySelector(".price-discount-major"),o=!!t.querySelector(".price-discount-minor"),f=!!t.querySelector(".price-discount"),p=(a?1:0)|(f?2:0)|(o?4:0),i=(L?1:0)|(q?2:0)|(D?4:0);if((p&i)===0)return!1}if(v||k||j){const a=t.classList.contains("wished"),o=t.classList.contains("followed");if(j){if(a||o)return!1}else if(!a&&!o||v!==a&&k!==o)return!1}if(C&&t.classList.contains("ignored"))return!1;if(T||b){const a=t.classList.contains("owned");if(T&&a)return!1;if(b&&!a)return!1}return!0}),m.addEventListener("submit",function(e){const n=[".fancy-price-input",".fancy-date-input",'input[name="max_reviews"]','input[name="min_followers"]','input[name="max_followers"]'];G!=="sales"&&(n.push('input[name="min_reviews"]'),m.querySelectorAll("#js-input-discount, #js-input-rating").forEach(c=>{c.value===c.min&&(c.disabled=!0)}));for(const i of n)m.querySelectorAll(i).forEach(u=>{Number(u.value)<=0&&(u.disabled=!0)});const s=["js-select-type","js-select-os"];m.querySelector(".fancy-price-input:not([disabled])")||s.push("js-select-cc");for(const i of s){const c=document.getElementById(i);if(!c)continue;const u=c.querySelector("input:checked");u&&c.dataset.default===u.value&&(u.disabled=!0)}const t=document.querySelectorAll("#js-select-tags .filter-scrollable input");if(t.length>0){const i=[];for(const c of t)c.checked&&(i.push(c.indeterminate?`-${c.value}`:c.value),c.disabled=!0);if(i.length>0){i.sort();{const u=document.createElement("input");u.type="hidden",u.name="tagid",u.value=i.join(","),m.append(u)}if(!m.querySelector("#js-match-all-tags").checked){const u=document.createElement("input");u.type="hidden",u.name="any_tag",u.value="1",m.append(u)}}}const a=document.querySelectorAll("#js-select-categories input");if(a.length>0){const i=[];for(const c of a)c.checked&&(i.push(c.indeterminate?`-${c.value}`:c.value),c.disabled=!0);if(i.length>0){i.sort();const c=document.createElement("input");c.type="hidden",c.name="category",c.value=i.join(","),m.append(c)}}const o=new URLSearchParams(location.search).get("sort");if(o){const i=document.createElement("input");i.type="hidden",i.name="sort",i.value=o,m.append(i)}const f=new FormData(m),p=new URLSearchParams(f);p.sort(),window.location.search=p.toString(),P(),e.preventDefault()}),m.addEventListener("change",function(){const e=document.querySelector("#js-filter-submit");e.disabled=!1},{once:!0}),document.querySelector("#js-filter-submit").addEventListener("click",P),document.querySelector("#js-input-rating").addEventListener("input",function(){const e=document.querySelector("#js-value-rating");e.textContent=this.value}),document.querySelector("#js-input-discount").addEventListener("input",function(){const e=Number(this.value),n=document.querySelector("#js-value-discount");n.textContent=e>0||n.dataset.zero?`\u2265${e}`:`>${e}`});const O=document.querySelector('input[name="min_release"]');if(O){const e=document.querySelector('input[name="max_release"]');O.value&&e.setAttribute("min",O.value),O.addEventListener("change",function(){e.setAttribute("min",this.value||O.getAttribute("min"))})}document.querySelectorAll(".steamy-checkbox-control").forEach(e=>{e.addEventListener("keydown",function(n){n.key==="Enter"&&(n.preventDefault(),this.click())})});const Y=document.getElementById("js-week-button");if(Y){const e=document.querySelector("#js-week-input");if(e.type!=="week"){if(e.value){const n=e.value.match(/^([0-9]{4})-?W([0-9]{2})$/);if(n){const[s,t]=n.slice(1,3).map(Number),a=new Date(Date.UTC(s,0,4+(3-(new Date(Date.UTC(s,0,4)).getUTCDay()+6)%7))),o=new Date(a);o.setUTCDate(a.getUTCDate()+(t-1)*7-3);const f=o.getUTCFullYear(),p=String(o.getUTCMonth()+1).padStart(2,"0"),i=String(o.getUTCDate()).padStart(2,"0");e.value=`${f}-${p}-${i}`}}e.type="date"}e.type==="text"||!("showPicker"in HTMLInputElement.prototype)?Y.classList.remove("is-supported"):(e.addEventListener("change",function(){if(!e.checkValidity()||!e.value)return;const n=new URLSearchParams(location.search);if(n.delete("lastweek"),e.type==="week")n.set("week",e.value.replace("-",""));else if(e.type==="date"){const s=new Date(e.value),t=(s.getUTCDay()+6)%7;s.setUTCDate(s.getUTCDate()-t+3);const a=new Date(Date.UTC(s.getUTCFullYear(),0,4)),o=(a.getUTCDay()+6)%7;a.setUTCDate(a.getUTCDate()-o+3);const f=Math.floor((s.getTime()-a.getTime())/(10080*60*1e3))+1,p=s.getUTCFullYear();n.set("week",`${p}W${String(f).padStart(2,"0")}`)}P(),n.sort(),location.href=`/upcoming/?${n}`}),Y.addEventListener("click",function(n){n.preventDefault(),e.focus(),e.showPicker()}))}const B=document.querySelector(".table-sales");window.matchMedia("(max-width: 979px)").matches&&B.classList.remove("table-hover");let S=[[0,"desc"],[5,"desc"],[3,"desc"]];const R=[3,5,8];if(G!=="week"&&R.push(6),Q==="OwnedGames")R.push(7),S=[[8,"desc"]];else if(G!=="sales"){const e=B.classList.contains("table-display-rank"),n=B.classList.contains("table-display-followers");e?S=[[0,"asc"]]:n?S=[[0,"desc"]]:S=[[5,"desc"],[7,"desc"],[0,"desc"]],n?R.push(0,7,8):R.push(0,7,9)}{const e=new URLSearchParams(location.search).get("sort");if(e){const n=e.split(",");S=[];for(const s of n){const t=s.split("_",2);S.push({name:t[0],dir:t[1]==="asc"?"asc":"desc"})}}}const ie=document.getElementById("js-filter-no-results");let ce=ie.hidden,h=!0;document.querySelectorAll("relative-time").forEach(e=>{e.remove()}),d=$(B).DataTable({columnDefs:[{orderSequence:["desc","asc"],targets:R}],order:S,initComplete(){queueMicrotask(()=>{r.OnExtensionUserdataLoaded(()=>{ue()}),$("#js-app .dt-search").addClass("tooltipped tooltipped-n").attr("aria-label",`Use keywords to find matches.
"Quotes" for exact phrases.
Exclude terms with ! symbol, e.g. "!demo"`),A&&$('#js-app th[data-name="id"] .dt-column-header').addClass("tooltipped tooltipped-n").attr("aria-label","Deal Rank"),V(),d.trigger("column-sizing"),K(),window.removeEventListener("error",W)})},drawCallback(){const e=this.api().page.info().recordsDisplay;de.textContent=e.toLocaleString();const n=e>0;ce!==n&&(ce=n,ie.hidden=n),F(),r.HideHoverIfAny()}}).on("order.dt",function(){if(h){h=!1;return}const e=d.order(),n=[];for(const o of e){if(!o[1])continue;const f=d.column(o[0]).header();f&&n.push(`${f.dataset.name}_${o[1]}`)}const s=n.join(",");let t=new URLSearchParams(location.search);s?t.set("sort",s):t.delete("sort"),t.sort(),window.history.replaceState(null,null,Array.from(t).length?`${location.pathname}?${t}`:location.pathname),document.querySelectorAll(".js-params-url").forEach(o=>{t=new URLSearchParams(o.search),s?t.set("sort",s):t.delete("sort"),t.sort(),o.search=t.toString()})}).on("page.dt",function(){window.requestAnimationFrame(()=>{document.querySelector(".table-container").scrollIntoView({behavior:"instant",block:"start"})})})})();
